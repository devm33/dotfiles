#vim:ft=bash

if [[ `uname` ==  'Linux' ]]
then
    alias p="prodaccess"
    alias gsutil='/google/data/ro/projects/cloud/bigstore/tools/gsutil.par'
fi

# git5
alias g5="git5"
alias g5e="git5 export"
alias g5s="git5 submit"
function git5_submit_msg {
    git5 submit -y -d "$*"
}
alias g5d=git5_submit_msg
function git5_send_all {
    git add -A
    git commit -m "$*"
    prodcertstatus -q || prodaccess
    git5 submit -y -d "$*"
}
alias g5a=git5_send_all

# g4
export P4DIFF='vimdiff'
if [ -r /etc/bash_completion.d/g4d ]; then
    source /etc/bash_completion.d/g4d
    function g4g {
        cd $(g4 opened | head -n 1 | cut  -d' ' -f1 | sed 's/^\/\/depot\/google3\///' | xargs dirname)
    }
    function g4dd {
        g4d $1
        clear
        g4g
    }
    compdef g4dd=g4d
fi
if [ -r /etc/bash_completion.d/p4 ]; then
    source /etc/bash_completion.d/p4
fi

# blaze
#cache-path must exist
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.zsh/cache

# flag tab completion for blaze binaries niiice
if [ -r /etc/bash_completion.d/flag_completion ]; then
    source /etc/bash_completion.d/flag_completion
fi

# gsutil
function gsls {
    gsutil ls $1 gs://mps-storage/devrajm
}
function gsadd {
    if [ -z "$1" ]
    then
        echo 'Specifiy file to upload'
    fi
    safename=`echo $1 | sed -e "s/[^a-zA-Z0-9.~_-]/_/g"`
    gsutil -m -o 'GSUtil:parallel_composite_upload_threshold=157286400' cp $1 gs://mps-storage/devrajm/$safename
    gsutil acl ch -u 'AllUsers:R' "gs://mps-storage/devrajm/$safename"
    echo "https://storage.googleapis.com/mps-storage/devrajm/$safename"
}
alias gs+='gsadd'

function drive {
    DRIVE="$HOME/Google Drive/"
    if [ -z "$1" ]
    then
        echo 'Specify dir to move and link'
    else
        mv ./$1 $DRIVE
        ln -s $DRIVE$1 ./
    fi
}

# Note global doesnt work for zsh, have to use specified
_python_argcomplete() {
    local IFS=''
    COMPREPLY=( $(IFS="$IFS"                   COMP_LINE="$COMP_LINE"                   COMP_POINT="$COMP_POINT"                   _ARGCOMPLETE_COMP_WORDBREAKS="$COMP_WORDBREAKS"                   _ARGCOMPLETE=1                   "$1" 8>&1 9>&2 1>/dev/null 2>/dev/null) )
    if [[ $? != 0 ]]; then
        unset COMPREPLY
    fi
}
complete -o nospace -o default -F _python_argcomplete "md.py"
alias m='md.py'

# Android studio

# Crow (Android emulator)
if [[ `uname` ==  'Linux' ]]
then
    fpath=(  /google/data/ro/teams/mobile_eng_prod/crow $fpath )
    autoload _crow
    compdef _crow /google/data/ro/teams/mobile_eng_prod/crow/crow.par
    alias crow=/google/data/ro/teams/mobile_eng_prod/crow/crow.par
fi

# Use adb.turbo when possible, otherwise use standard adb.
function adb() {
  EMU_DEPS=/google/data/ro/teams/mobile_eng_prod/emu/live/google3/
  ANDROID_SDK=${EMU_DEPS}/third_party/java/android/android_sdk_linux/
  EMU_SUPPORT=${EMU_DEPS}/tools/android/emulator/support/
  ANDROID_ADB=${ANDROID_SDK}/platform-tools/adb
  ANDROID_ADB=${ANDROID_ADB} $EMU_SUPPORT/adb.turbo "$@"
}

# Add the internal Android SDK to your PATH
export SDK_LOC=/google/data/ro/teams/as-with-blaze/android-sdk-linux
export PATH=${PATH}:${SDK_LOC}/tools:${SDK_LOC}/platform-tools

# mDialog

# mdialog scripts
if [ -d /usr/local/google/home/devrajm/code/src_mdialog/sandbox/shell_scripts ]
then
    export PATH="$PATH:/usr/local/google/home/devrajm/code/src_mdialog/sandbox/shell_scripts"
fi

alias cbsn-media='md.py cbsn manifest | grep ^http | xargs curl -s | grep MEDIA-SEQ | sort | uniq'
alias cbsn-disc='md.py cbsn manifest | grep ^http | xargs curl -s | grep ITY-SEQ | sort | uniq'
